<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Hamiltonian Diagonalization: diagonalization::Observables Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Hamiltonian Diagonalization
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structdiagonalization_1_1Observables.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structdiagonalization_1_1Observables-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">diagonalization::Observables Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a47d8b95f4bd6a9c21860f3bed5d1d17a"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a47d8b95f4bd6a9c21860f3bed5d1d17a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a47d8b95f4bd6a9c21860f3bed5d1d17a">DensityFunction</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, double *probabilityList, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a47d8b95f4bd6a9c21860f3bed5d1d17a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a list of the total probability associated with each orbital for a given eigenvector i.e. a table of &lt; c^+_k c_k &gt;  <a href="#a47d8b95f4bd6a9c21860f3bed5d1d17a">More...</a><br/></td></tr>
<tr class="separator:a47d8b95f4bd6a9c21860f3bed5d1d17a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a1942330b225f5e86ecbe75c6b99210"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a6a1942330b225f5e86ecbe75c6b99210"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a6a1942330b225f5e86ecbe75c6b99210">DensityDensityFunction</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, double *probabilityList, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a6a1942330b225f5e86ecbe75c6b99210"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a list of the total density-density operator associated with a pair of orbitals for a given eigenvector i.e. a table of &lt; c^+_k c_k c^+ q c_q&gt;  <a href="#a6a1942330b225f5e86ecbe75c6b99210">More...</a><br/></td></tr>
<tr class="separator:a6a1942330b225f5e86ecbe75c6b99210"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad45972c4fdafd4512a218128054c9684"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:ad45972c4fdafd4512a218128054c9684"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#ad45972c4fdafd4512a218128054c9684">TranslationalDensityDensityFunction</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1, const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2)&gt; <a class="el" href="namespacediagonalization.html#a64d001257466117013a4487a4c5ea64a">StateAddition</a>, std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1, const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2)&gt; <a class="el" href="namespacediagonalization.html#abf38b3571fb3d1613b56a18dec321d30">StateSubtraction</a>, std::vector&lt; double &gt; &amp;functionList, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:ad45972c4fdafd4512a218128054c9684"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a list of the total translational density-density operator associated with a pair of orbitals for a given eigenvector.  <a href="#ad45972c4fdafd4512a218128054c9684">More...</a><br/></td></tr>
<tr class="separator:ad45972c4fdafd4512a218128054c9684"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eb11fb2f78f62d0683220c1b3ace2a7"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a7eb11fb2f78f62d0683220c1b3ace2a7"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a7eb11fb2f78f62d0683220c1b3ace2a7">RotationalDensityDensityFunction</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k, const int nbrApplied)&gt; <a class="el" href="namespacediagonalization.html#a365c394bec84845c4c7c0809640d4d18">R60</a>, std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k, const int nbrApplied)&gt; <a class="el" href="namespacediagonalization.html#aab386aacdb21dd7030d9dc9d5caf6d25">InverseR60</a>, <a class="el" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a> *functionList, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a7eb11fb2f78f62d0683220c1b3ace2a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a list of the total rotational density-density operator associated with a pair of orbitals for a given eigenvector.  <a href="#a7eb11fb2f78f62d0683220c1b3ace2a7">More...</a><br/></td></tr>
<tr class="separator:a7eb11fb2f78f62d0683220c1b3ace2a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57998cbba3daee2273397eb2257d93b9"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a57998cbba3daee2273397eb2257d93b9"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a57998cbba3daee2273397eb2257d93b9">GetMostProbable</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> nbrStates, <a class="el" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> *states, <a class="el" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a> *amplitudes, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a57998cbba3daee2273397eb2257d93b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the nbrStates most probable eigenstates and their amplitudes to a set of buffers.  <a href="#a57998cbba3daee2273397eb2257d93b9">More...</a><br/></td></tr>
<tr class="separator:a57998cbba3daee2273397eb2257d93b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e2f51b4cc7caee30871c1b061f5846b"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a3e2f51b4cc7caee30871c1b061f5846b"><td class="memTemplItemLeft" align="right" valign="top">double&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a3e2f51b4cc7caee30871c1b061f5846b">GetParticipationRatio</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a3e2f51b4cc7caee30871c1b061f5846b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the fractional participation ratio and store it in a file.  <a href="#a3e2f51b4cc7caee30871c1b061f5846b">More...</a><br/></td></tr>
<tr class="separator:a3e2f51b4cc7caee30871c1b061f5846b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af94c7e6aee360332a4a687727acb9a69"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:af94c7e6aee360332a4a687727acb9a69"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#af94c7e6aee360332a4a687727acb9a69">ParticleEntanglementSpectrumToFile</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> nbrA, const std::string fileName, const <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:af94c7e6aee360332a4a687727acb9a69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the particle entanglement spectrum and store in a file.  <a href="#af94c7e6aee360332a4a687727acb9a69">More...</a><br/></td></tr>
<tr class="separator:af94c7e6aee360332a4a687727acb9a69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c4370c1eade403230a373bfc5834a5a"><td class="memTemplParams" colspan="2">template&lt;class H &gt; </td></tr>
<tr class="memitem:a2c4370c1eade403230a373bfc5834a5a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structdiagonalization_1_1Observables.html#a2c4370c1eade403230a373bfc5834a5a">OrbitalEntanglementSpectrumToFile</a> (const H &amp;hamiltonian, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> eigenvectorIndex, const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> orbitalCut, const std::string fileName, <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;<a class="el" href="fqhe__sphere__spinless__fermions__diagonalization_8cpp.html#a1a7112d51c59f426cab52975031ff6e7">mpi</a>)</td></tr>
<tr class="memdesc:a2c4370c1eade403230a373bfc5834a5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the orbital entanglement spectrum and store in a file.  <a href="#a2c4370c1eade403230a373bfc5834a5a">More...</a><br/></td></tr>
<tr class="separator:a2c4370c1eade403230a373bfc5834a5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00039">39</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a6a1942330b225f5e86ecbe75c6b99210"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::DensityDensityFunction </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>probabilityList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a list of the total density-density operator associated with a pair of orbitals for a given eigenvector i.e. a table of &lt; c^+_k c_k c^+ q c_q&gt; </p>
<p>This function MUST be called on all nodes if run in parallel </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to analyse </td></tr>
    <tr><td class="paramname">probabilityList</td><td>Pre-allocated array of size m_nbrOrbitals*m_nbrOrbitals to store a map of occupation probabilities </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00117">117</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in DensityDensityFunction: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                <span class="comment">//  Ensure that the probability list is initialized to zero</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = 0; i&lt;hamiltonian.m_data.m_nbrOrbitals*hamiltonian.m_data.m_nbrOrbitals; ++i)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    probabilityList[i] = 0.0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="comment">//  Apply the operator c^+_k c_k c^+ q c_q to each Fock state</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="comment">//  and then determine the matrix element with the initial</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="comment">//  Fock state</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="comment">//  A non-zero result will occur in only two cases:</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="comment">//  1. The initial state contains q, but not k. This requires k=q</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="comment">//  (and gives the value n_k^2)</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="comment">//  2. The initial state contains both q and k. This requires k!=q</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="comment">//  Loop over the Fock basis. For each state, pick out the N occupied orbitals</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="comment">//  corresponding to q. We use this to calculate n_k^2, then we loop over the </span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="comment">//  remaining N-1 orbitals containing the possible values of k. The value</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="comment">//  of n_k n_q is added to a bin (k,q)</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">DivideTasks</a>(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>, hamiltonian.m_data.m_fockSpaceDim, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                std::vector&lt;fock_t&gt;::const_iterator it_state;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> currState = hamiltonian.m_fockBasis.GetFirstState(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, hamiltonian.m_data.m_nbrParticles, it_state);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="keyword">auto</span> it_eigs = hamiltonian.m_eigenvectors.begin() + eigenvectorIndex*hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>; i&lt;=mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>; ++i, ++it_eigs)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> inState = currState;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    <span class="keywordtype">double</span> currProb = std::real(*it_eigs * std::conj(*it_eigs));</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> tempState = inState;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    <span class="keywordflow">while</span>(tempState!=0) <span class="comment">//  Iterate over N terms</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        <span class="comment">//  Isolate successive right-most bits until we&#39;ve included all</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        <span class="comment">//  occupied states in the current basis state</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                        <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> kOccupied = tempState &amp; -tempState;      </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                        <span class="comment">//  Bin the probability as n_k n_k</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        uint64_t index = <a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(kOccupied-1);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        probabilityList[index*hamiltonian.m_data.m_nbrOrbitals+index] += currProb;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        tempState = tempState ^ kOccupied;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        <span class="comment">//  Remove only the single selected bit from the in state,</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        <span class="comment">//  leaving N-1 set bits </span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> oneRemoved = inState ^ kOccupied;  </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        <span class="comment">//  Inner iteration over all but the removed bit</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keywordflow">while</span>(oneRemoved!=0)    <span class="comment">//  Iterate over N-1 terms</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                            <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> qOccupied = oneRemoved &amp; -oneRemoved;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                            <span class="comment">//  Bin the probability as n_k n_q</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                            probabilityList[index*hamiltonian.m_data.m_nbrOrbitals+<a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(qOccupied-1)] += currProb;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                            <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                            oneRemoved = oneRemoved ^ qOccupied;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                        }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    currState = hamiltonian.m_fockBasis.GetNextState(currState,it_state);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                MPI_Barrier(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="comment">//  Allocate a temporary buffer for MPI communication</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordtype">double</span>* reduceBuffer = <span class="keyword">new</span> <span class="keywordtype">double</span>[hamiltonian.m_data.m_nbrOrbitals*hamiltonian.m_data.m_nbrOrbitals];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                MPI_Status status;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">Reduce</a>(probabilityList, reduceBuffer, hamiltonian.m_data.m_nbrOrbitals*hamiltonian.m_data.m_nbrOrbitals, </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                           0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>,status);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="comment">//  MPI_sync the return array over all nodes</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">Sync</a>(probabilityList, hamiltonian.m_data.m_nbrOrbitals*hamiltonian.m_data.m_nbrOrbitals, 0);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="keyword">delete</span>[] reduceBuffer;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a58a92efc3951241eb3548b58bdf2c5ab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">utilities::MpiWrapper::DivideTasks</a></div><div class="ttdeci">void DivideTasks(const int id, const int nbrTasks, int nbrProcs, int *firstTask, int *lastTask, const bool display) const </div><div class="ttdoc">DivideTasks divides up nbrTasks tasks amongst nbrProcs processes On the processor labelled by the ide...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00166">mpi_wrapper.cpp:166</a></div></div>
<div class="ttc" id="namespaceutilities_1_1binary_html_a067057e4bb4d8570a644f35f3cf0b88f"><div class="ttname"><a href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a></div><div class="ttdeci">int HammingWeight64(uint64_t x)</div><div class="ttdoc">Hamming weight algorithm with minimal number of arithmetic operations. </div><div class="ttdef"><b>Definition:</b> <a href="binary__number__tools_8cpp_source.html#l00095">binary_number_tools.cpp:95</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_aafee6ab3a3b23174586b41f38da96bab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">utilities::MpiWrapper::m_firstTask</a></div><div class="ttdeci">int m_firstTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00061">mpi_wrapper.hpp:61</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_acd224a7c1052298744ef984a3341b66e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">utilities::MpiWrapper::Reduce</a></div><div class="ttdeci">void Reduce(T *reduceBuffer, T *recvBuffer, int bufferCount, int reduceId, MPI_Comm comm, MPI_Status status) const </div><div class="ttdoc">A function to implement MPI Reduce, but with different sizes of buffer on each node (the standard MPI...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00262">mpi_wrapper.hpp:262</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="namespacediagonalization_html_adeb6d2d193b9d4a086509c6e933a2096"><div class="ttname"><a href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">diagonalization::fock_t</a></div><div class="ttdeci">uint64_t fock_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00036">orbital_and_state_defs.hpp:36</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a948a6b1b3daa673cc4ebd93eb0af6770"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">utilities::MpiWrapper::m_lastTask</a></div><div class="ttdeci">int m_lastTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00064">mpi_wrapper.hpp:64</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_ab7c5634cdbed7e4436b54b9ef619f85b"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">utilities::MpiWrapper::Sync</a></div><div class="ttdeci">void Sync(std::string &amp;buffer, int syncNode) const </div><div class="ttdoc">A function to MPI synchronize a string. </div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00345">mpi_wrapper.cpp:345</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a47d8b95f4bd6a9c21860f3bed5d1d17a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::DensityFunction </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>probabilityList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a list of the total probability associated with each orbital for a given eigenvector i.e. a table of &lt; c^+_k c_k &gt; </p>
<p>This function MUST be called on all nodes if run in parallel </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to analyse </td></tr>
    <tr><td class="paramname">probabilityList</td><td>Pre-allocated array of size m_nbrOrbitals To store a map of occupation probabilities </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00048">48</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                    {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in DensityFunction: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                <span class="comment">//  Ensure that the probability list is initialized to zero</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = 0; i&lt;hamiltonian.m_data.m_nbrOrbitals; ++i)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                    probabilityList[i] = 0.0;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="comment">//  Loop over the Fock basis. For each state, pick out the N occupied orbitals</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="comment">//  and update the corresponding bin in the probability table with the</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="comment">//  value stored in the chosen eigenvector</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">DivideTasks</a>(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>,hamiltonian.m_data.m_fockSpaceDim, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                std::vector&lt;fock_t&gt;::const_iterator it_state;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> currState = hamiltonian.m_fockBasis.GetFirstState(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, hamiltonian.m_data.m_nbrParticles, it_state);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="keyword">auto</span> it_eigs = hamiltonian.m_eigenvectors.begin() + eigenvectorIndex*hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>; i&lt;=mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>; ++i, ++it_eigs)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> inState = currState;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    <span class="keywordtype">double</span> currProb = std::real(*it_eigs * std::conj(*it_eigs));</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    <span class="keywordflow">while</span>(inState!=0)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                        <span class="comment">//  Isolate successive right-most bits until we&#39;ve included all</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        <span class="comment">//  occupied states in the current basis state</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                        <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                        <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> kOccupied = inState &amp; -inState;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                        <span class="comment">//  Bin the probability</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        probabilityList[<a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(kOccupied-1)] += currProb;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                        <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                        inState = inState ^ kOccupied;     </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    currState = hamiltonian.m_fockBasis.GetNextState(currState, it_state);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="comment">//  Sum up all the contributions to the probability list</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="comment">//  and keep the total on the master node</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keywordtype">double</span>* buffer = <span class="keyword">new</span> <span class="keywordtype">double</span>[hamiltonian.m_data.m_nbrOrbitals];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                MPI_Status status;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">Reduce</a>&lt;<span class="keywordtype">double</span>&gt;(probabilityList, buffer, hamiltonian.m_data.m_nbrOrbitals, 0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>, status);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="keyword">delete</span>[] buffer;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                MPI_Barrier(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a58a92efc3951241eb3548b58bdf2c5ab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">utilities::MpiWrapper::DivideTasks</a></div><div class="ttdeci">void DivideTasks(const int id, const int nbrTasks, int nbrProcs, int *firstTask, int *lastTask, const bool display) const </div><div class="ttdoc">DivideTasks divides up nbrTasks tasks amongst nbrProcs processes On the processor labelled by the ide...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00166">mpi_wrapper.cpp:166</a></div></div>
<div class="ttc" id="namespaceutilities_1_1binary_html_a067057e4bb4d8570a644f35f3cf0b88f"><div class="ttname"><a href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a></div><div class="ttdeci">int HammingWeight64(uint64_t x)</div><div class="ttdoc">Hamming weight algorithm with minimal number of arithmetic operations. </div><div class="ttdef"><b>Definition:</b> <a href="binary__number__tools_8cpp_source.html#l00095">binary_number_tools.cpp:95</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_aafee6ab3a3b23174586b41f38da96bab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">utilities::MpiWrapper::m_firstTask</a></div><div class="ttdeci">int m_firstTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00061">mpi_wrapper.hpp:61</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_acd224a7c1052298744ef984a3341b66e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">utilities::MpiWrapper::Reduce</a></div><div class="ttdeci">void Reduce(T *reduceBuffer, T *recvBuffer, int bufferCount, int reduceId, MPI_Comm comm, MPI_Status status) const </div><div class="ttdoc">A function to implement MPI Reduce, but with different sizes of buffer on each node (the standard MPI...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00262">mpi_wrapper.hpp:262</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="namespacediagonalization_html_adeb6d2d193b9d4a086509c6e933a2096"><div class="ttname"><a href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">diagonalization::fock_t</a></div><div class="ttdeci">uint64_t fock_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00036">orbital_and_state_defs.hpp:36</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a948a6b1b3daa673cc4ebd93eb0af6770"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">utilities::MpiWrapper::m_lastTask</a></div><div class="ttdeci">int m_lastTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00064">mpi_wrapper.hpp:64</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a57998cbba3daee2273397eb2257d93b9"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::GetMostProbable </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>nbrStates</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> *&#160;</td>
          <td class="paramname"><em>states</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a> *&#160;</td>
          <td class="paramname"><em>amplitudes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function returns the nbrStates most probable eigenstates and their amplitudes to a set of buffers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">nbrStates</td><td>The number of most probable states to be returned </td></tr>
    <tr><td class="paramname">states</td><td>A buffer to store the returned Fock states ( of size nbrStates*nbr eigenvectors) </td></tr>
    <tr><td class="paramname">amplitudes</td><td>A buffer to store the associated amplitudes (of size nbrStates*nbr eigenvectors) </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00438">438</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                <span class="comment">//  Note that we cannot return more most probable amplitudes than the fock space dimension</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> actualNbrStates = std::min(hamiltonian.m_data.m_fockSpaceDim, (<a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>)nbrStates);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                <span class="comment">//  Note that we cannot sort more amplitudes than are stored on a given node</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                <a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> nbrStatesPerNode = std::min(hamiltonian.GetEigenvectorNodeDim(), (<a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>)nbrStates);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> totalNbrStates = 0;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="comment">//  Get the total number of states sorted on each node</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                MPI_Allreduce(&amp;nbrStatesPerNode, &amp;totalNbrStates, 1, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#af18344940a2fccb1c210a8f9f33a1b6e">GetType</a>&lt;<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&gt;(), MPI_SUM, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> e=0; e&lt;hamiltonian.m_data.m_nbrEigenvalues; ++e)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)    <span class="comment">//  FOR THE MASTER NODE</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                        <a class="code" href="namespaceutilities.html#a8bd217ae821e52872836b15f651f5d9f">utilities::cout</a>.<a class="code" href="classutilities_1_1Cout.html#a2d11fc59d54199d37f4627dc645dff93">AdditionalInfo</a>()&lt;&lt;<span class="stringliteral">&quot;\n\t For eigenvector &quot;</span>&lt;&lt;e&lt;&lt;std::endl;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    <span class="comment">//  On each node make a copy of the eigenvector data and the Fock</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                    <span class="comment">//  state data into buffers to be used for sorting</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    <a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>* eigsBuffer = 0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>* fockBuffer = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> eigenvectorNodeDim = hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    <span class="keywordflow">if</span>(hamiltonian.GetEigenvectorNodeDim()&gt;0)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                    {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                        eigsBuffer = <span class="keyword">new</span> <a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>[eigenvectorNodeDim];</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        fockBuffer = <span class="keyword">new</span> <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>[eigenvectorNodeDim];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        memcpy(eigsBuffer, &amp;hamiltonian.m_eigenvectors[0]+e*eigenvectorNodeDim, eigenvectorNodeDim*<span class="keyword">sizeof</span>(<a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>));</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        hamiltonian.m_fockBasis.GetFockBasis(fockBuffer, eigenvectorNodeDim, mpi);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        <span class="comment">//  Partially sort each eigenvector in place into descending order </span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        <span class="comment">//  (using the abs value as a comparison function)</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        utilities::PartialQuickSort&lt;dcmplx, fock_t, _DESCENDING_ORDER_&gt;(eigsBuffer, fockBuffer, eigenvectorNodeDim, </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                                                                        nbrStatesPerNode);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                    }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                    <span class="comment">//  Gather the sorted values onto the master node, then perform a further</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                    <span class="comment">//  sort to single out the overall highest nbrStates values to be returned</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    <span class="comment">//  Note that we only need to use the first nbrStates values from each node </span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>* gatherAmplitudesBuffer = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>* gatherStatesBuffer     = 0;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)    <span class="comment">//  FOR THE MASTER NODE</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        gatherAmplitudesBuffer = <span class="keyword">new</span> <a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>[nbrStates*mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                        gatherStatesBuffer     = <span class="keyword">new</span> <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>[nbrStates*mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                    }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    MPI_Status status;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                    mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a891ad0d4731f9a66311170d22f32b9e4">Gather</a>(eigsBuffer, nbrStatesPerNode, gatherAmplitudesBuffer,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                               totalNbrStates, 0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>, status);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                    mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a891ad0d4731f9a66311170d22f32b9e4">Gather</a>(fockBuffer, nbrStatesPerNode, gatherStatesBuffer,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                               totalNbrStates, 0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>, status);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    <span class="comment">//  Now we can deallocate the eigenvectors/fock states buffers on each node</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    <span class="keyword">delete</span>[] eigsBuffer;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    <span class="keyword">delete</span>[] fockBuffer;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    <span class="comment">//  Partially sort the combined list of values to obtain the most probable</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <span class="comment">//  states, then copy these into the return vectors</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)    <span class="comment">//  FOR THE MASTER NODE </span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                    {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                        utilities::PartialQuickSort&lt;dcmplx, fock_t, _DESCENDING_ORDER_&gt;(gatherAmplitudesBuffer, gatherStatesBuffer, </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                                                                        totalNbrStates, actualNbrStates);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                        memcpy(amplitudes+e*actualNbrStates, gatherAmplitudesBuffer, nbrStates*<span class="keyword">sizeof</span>(<a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a>));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        memcpy(states+e*actualNbrStates, gatherStatesBuffer, nbrStates*<span class="keyword">sizeof</span>(<a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>));</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                        <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i=0; i&lt;nbrStates; ++i)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                        {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                            <a class="code" href="namespaceutilities.html#a8bd217ae821e52872836b15f651f5d9f">utilities::cout</a>.<a class="code" href="classutilities_1_1Cout.html#a2d11fc59d54199d37f4627dc645dff93">AdditionalInfo</a>()&lt;&lt;<span class="stringliteral">&quot;\t State &quot;</span>&lt;&lt;std::setw(15)&lt;&lt;std::left&lt;&lt;states[i+e*actualNbrStates]&lt;&lt;<span class="stringliteral">&quot;\t Amplitude &quot;</span>&lt;&lt;std::setw(15)&lt;&lt;std::left&lt;&lt;amplitudes[i+e*actualNbrStates]&lt;&lt;std::endl;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                        }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    <span class="comment">//  Free up the gather buffer memory</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                    <span class="keywordflow">if</span>(0 != gatherAmplitudesBuffer) <span class="keyword">delete</span>[] gatherAmplitudesBuffer;          </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    <span class="keywordflow">if</span>(0 != gatherStatesBuffer)     <span class="keyword">delete</span>[] gatherStatesBuffer;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a891ad0d4731f9a66311170d22f32b9e4"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a891ad0d4731f9a66311170d22f32b9e4">utilities::MpiWrapper::Gather</a></div><div class="ttdeci">void Gather(T *sendBuffer, int sendCount, T *recvBuffer, int recvCount, int gatherId, MPI_Comm comm, MPI_Status status) const </div><div class="ttdoc">A function to implement MPI Gather, but with different sizes of buffer on each node (the standard MPI...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00147">mpi_wrapper.hpp:147</a></div></div>
<div class="ttc" id="namespaceutilities_html_a8bd217ae821e52872836b15f651f5d9f"><div class="ttname"><a href="namespaceutilities.html#a8bd217ae821e52872836b15f651f5d9f">utilities::cout</a></div><div class="ttdeci">Cout cout</div><div class="ttdef"><b>Definition:</b> <a href="optical__flux__lattice__noninteracting__model_8cpp_source.html#l00035">optical_flux_lattice_noninteracting_model.cpp:35</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="classutilities_1_1Cout_html_a2d11fc59d54199d37f4627dc645dff93"><div class="ttname"><a href="classutilities_1_1Cout.html#a2d11fc59d54199d37f4627dc645dff93">utilities::Cout::AdditionalInfo</a></div><div class="ttdeci">std::ostream &amp; AdditionalInfo()</div><div class="ttdef"><b>Definition:</b> <a href="cout__tools_8hpp_source.html#l00132">cout_tools.hpp:132</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_af18344940a2fccb1c210a8f9f33a1b6e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#af18344940a2fccb1c210a8f9f33a1b6e">utilities::MpiWrapper::GetType</a></div><div class="ttdeci">MPI_Datatype GetType() const </div><div class="ttdoc">A template function to convert a given c variable type into an appropriate MPI type. </div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00314">mpi_wrapper.hpp:314</a></div></div>
<div class="ttc" id="namespacediagonalization_html_adeb6d2d193b9d4a086509c6e933a2096"><div class="ttname"><a href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">diagonalization::fock_t</a></div><div class="ttdeci">uint64_t fock_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00036">orbital_and_state_defs.hpp:36</a></div></div>
<div class="ttc" id="dcmplx__type__def_8hpp_html_a52196b4b274b585226e0614490f7defc"><div class="ttname"><a href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a></div><div class="ttdeci">std::complex&lt; double &gt; dcmplx</div><div class="ttdef"><b>Definition:</b> <a href="dcmplx__type__def_8hpp_source.html#l00014">dcmplx_type_def.hpp:14</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3e2f51b4cc7caee30871c1b061f5846b"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double diagonalization::Observables::GetParticipationRatio </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the fractional participation ratio and store it in a file. </p>
<p>Fractional participation ratio is defined as 1/ D sum |psi|^4. This function gives a measure of the proportion of orbitals over which the many body wave function may be considered to be localized</p>
<dl class="section return"><dt>Returns</dt><dd>Participation ratio </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to analyse </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00529">529</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in GetParticipationRatio: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="comment">//  Divide up calculation over multiple nodes</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">DivideTasks</a>(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>, hamiltonian.m_data.m_fockSpaceDim, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                <span class="keyword">auto</span> it_eigs = hamiltonian.m_eigenvectors.begin() + eigenvectorIndex*hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordtype">double</span> participationRatio = 0.0;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="keywordtype">double</span> totalParticipationRatio = 0.0;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>; i&lt;=mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>; ++i, ++it_eigs)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    participationRatio += std::pow(abs(*it_eigs), 4.0);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                MPI_Barrier(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="comment">//  Sum the participation ratio over all nodes</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                MPI_Allreduce(&amp;participationRatio, &amp;totalParticipationRatio, 1, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#af18344940a2fccb1c210a8f9f33a1b6e">GetType</a>&lt;<span class="keywordtype">double</span>&gt;(), MPI_SUM, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="comment">//  An estimate of the proportion of Fock states that</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="comment">//  mostly contribute to the eigenvector is given by</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="comment">//  1/ Dsum |psi|^4:</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="keywordflow">return</span> 1.0/(totalParticipationRatio);   <span class="comment">//hamiltonian.m_data.m_fockSpaceDim</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a58a92efc3951241eb3548b58bdf2c5ab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">utilities::MpiWrapper::DivideTasks</a></div><div class="ttdeci">void DivideTasks(const int id, const int nbrTasks, int nbrProcs, int *firstTask, int *lastTask, const bool display) const </div><div class="ttdoc">DivideTasks divides up nbrTasks tasks amongst nbrProcs processes On the processor labelled by the ide...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00166">mpi_wrapper.cpp:166</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_aafee6ab3a3b23174586b41f38da96bab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">utilities::MpiWrapper::m_firstTask</a></div><div class="ttdeci">int m_firstTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00061">mpi_wrapper.hpp:61</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_af18344940a2fccb1c210a8f9f33a1b6e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#af18344940a2fccb1c210a8f9f33a1b6e">utilities::MpiWrapper::GetType</a></div><div class="ttdeci">MPI_Datatype GetType() const </div><div class="ttdoc">A template function to convert a given c variable type into an appropriate MPI type. </div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00314">mpi_wrapper.hpp:314</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a948a6b1b3daa673cc4ebd93eb0af6770"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">utilities::MpiWrapper::m_lastTask</a></div><div class="ttdeci">int m_lastTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00064">mpi_wrapper.hpp:64</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2c4370c1eade403230a373bfc5834a5a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::OrbitalEntanglementSpectrumToFile </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>orbitalCut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>fileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the orbital entanglement spectrum and store in a file. </p>
<p>The OES is calculate directly from the eigenvector representing our wave function. First we group the set of site indices according to our particular choice of orbital cut. Then we take the SVD of the resulting (dense) matrix.</p>
<p>TODO implement orbital entanglement spectrum </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to decompose </td></tr>
    <tr><td class="paramname">orbitalCut</td><td>Orbital label at the cut </td></tr>
    <tr><td class="paramname">fileName</td><td>Output file name# </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00616">616</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af94c7e6aee360332a4a687727acb9a69"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::ParticleEntanglementSpectrumToFile </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>nbrA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>fileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the particle entanglement spectrum and store in a file. </p>
<p>TODO implement particle entanglement spectrum </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to decompose </td></tr>
    <tr><td class="paramname">nbrA</td><td>Number of particles in the A cut </td></tr>
    <tr><td class="paramname">fileName</td><td>Output file name </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00574">574</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            {   </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in ParticleEntanglementSpectrumToFile: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="comment">//  Calculate the particle entanglement spectrum</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="comment">//  Write the results to a text file</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7eb11fb2f78f62d0683220c1b3ace2a7"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::RotationalDensityDensityFunction </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k, const int nbrApplied)&gt;&#160;</td>
          <td class="paramname"><em>R60</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k, const int nbrApplied)&gt;&#160;</td>
          <td class="paramname"><em>InverseR60</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a> *&#160;</td>
          <td class="paramname"><em>functionList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a list of the total rotational density-density operator associated with a pair of orbitals for a given eigenvector. </p>
<p>Given by:</p>
<p>R(m) = 1/6N sum_{n,k} exp(i*m*n*pi/3) &lt;c^+_{R_n k} c_{R_n k} c^+_k c_k&gt;</p>
<p>Where m and n take values in {0,1,2,3,4,5}</p>
<p>This function MUST be called on all nodes if run in parallel </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to analyse </td></tr>
    <tr><td class="paramname">R60</td><td>A function to apply the R60 rotation on the given orbital </td></tr>
    <tr><td class="paramname">InverseR60</td><td>A function to apply the inverse R60 rotation on the given orbital </td></tr>
    <tr><td class="paramname">functionList</td><td>Pre-allocated array of size 6 to store a map of occupation probabilities </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00335">335</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> tol = 0.00000000001;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> nRot   = 6;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in RotationalDensityDensityFunction: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="comment">//  Ensure that the function list is initialized to zero</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> delta = 0; delta&lt;nRot; ++delta)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    functionList[delta] = 0.0;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                <span class="comment">//  For each Fock state, determine the set of k1,...,k4 and alpha,alpha&#39;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="comment">//  that will return the original state</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="comment">//  Loop over the Fock basis</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">DivideTasks</a>(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>, hamiltonian.m_data.m_fockSpaceDim, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                std::vector&lt;fock_t&gt;::const_iterator it_state;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> currState = hamiltonian.m_fockBasis.GetFirstState(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, hamiltonian.m_data.m_nbrParticles, it_state);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keyword">auto</span> it_eigs = hamiltonian.m_eigenvectors.begin() + eigenvectorIndex*hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>; i&lt;=mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>; ++i, ++it_eigs)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> inState = currState;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="keywordtype">double</span> currProb = std::real(*it_eigs * std::conj(*it_eigs));</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="keywordflow">if</span>(fabs(currProb) &gt; tol)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                        <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> tempState1 = inState; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        <span class="keywordflow">while</span>(tempState1!=0) <span class="comment">//  Iterate over N terms</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                        {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                            <span class="comment">//  Isolate successive right-most bits until we&#39;ve included all</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                            <span class="comment">//  occupied states in the current basis state</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                            <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k1Occupied = tempState1 &amp; -tempState1;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            <a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1 = <a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(k1Occupied-1);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                            <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> tempState2 = inState;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                            <span class="keywordflow">while</span>(tempState2!=0) <span class="comment">//  Iterate over N terms</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                            {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k2TempOccupied = tempState2 &amp; -tempState2;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                <a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2Temp = <a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(k2TempOccupied-1);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                <span class="comment">//  Sum over alpha that will produce this k2Temp value from k1</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> alpha = 0; alpha&lt;nRot; ++alpha)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                    <a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2 = <a class="code" href="namespacediagonalization.html#aab386aacdb21dd7030d9dc9d5caf6d25">InverseR60</a>(k2Temp,alpha);   </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                    <span class="keywordflow">if</span>(k2 == k1)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                    {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m = 0;m&lt;nRot;++m)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                        {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                            functionList[m] += currProb*exp(<a class="code" href="i__const__def_8hpp.html#ab03128f28254e912f824640e69fc85ad">I</a>*(<a class="code" href="pi__const__def_8hpp.html#a952eac791b596a61bba0a133a3bb439f">PI</a>/3.0)*(<span class="keywordtype">double</span>)(m*alpha));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                        }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                } </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                tempState2 = tempState2 ^ k2TempOccupied;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                            }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                            <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                            tempState1 = tempState1 ^ k1Occupied;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    currState = hamiltonian.m_fockBasis.GetNextState(currState, it_state);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                MPI_Barrier(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="comment">//  Allocate a temporary buffer for MPI communication</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <a class="code" href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a> reduceBuffer[nRot];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                MPI_Status status;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">Reduce</a>(functionList, reduceBuffer, nRot, 0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>, status);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                <span class="comment">//  MPI_sync the return array over all nodes</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">Sync</a>(functionList, nRot, 0);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="comment">//  Divide all values by a factor of nRot*N</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> delta = 0; delta&lt;nRot; ++delta)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    functionList[delta] /= nRot*hamiltonian.m_data.m_nbrParticles;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a58a92efc3951241eb3548b58bdf2c5ab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">utilities::MpiWrapper::DivideTasks</a></div><div class="ttdeci">void DivideTasks(const int id, const int nbrTasks, int nbrProcs, int *firstTask, int *lastTask, const bool display) const </div><div class="ttdoc">DivideTasks divides up nbrTasks tasks amongst nbrProcs processes On the processor labelled by the ide...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00166">mpi_wrapper.cpp:166</a></div></div>
<div class="ttc" id="namespaceutilities_1_1binary_html_a067057e4bb4d8570a644f35f3cf0b88f"><div class="ttname"><a href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a></div><div class="ttdeci">int HammingWeight64(uint64_t x)</div><div class="ttdoc">Hamming weight algorithm with minimal number of arithmetic operations. </div><div class="ttdef"><b>Definition:</b> <a href="binary__number__tools_8cpp_source.html#l00095">binary_number_tools.cpp:95</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_aafee6ab3a3b23174586b41f38da96bab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">utilities::MpiWrapper::m_firstTask</a></div><div class="ttdeci">int m_firstTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00061">mpi_wrapper.hpp:61</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_acd224a7c1052298744ef984a3341b66e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">utilities::MpiWrapper::Reduce</a></div><div class="ttdeci">void Reduce(T *reduceBuffer, T *recvBuffer, int bufferCount, int reduceId, MPI_Comm comm, MPI_Status status) const </div><div class="ttdoc">A function to implement MPI Reduce, but with different sizes of buffer on each node (the standard MPI...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00262">mpi_wrapper.hpp:262</a></div></div>
<div class="ttc" id="namespacediagonalization_html_aab386aacdb21dd7030d9dc9d5caf6d25"><div class="ttname"><a href="namespacediagonalization.html#aab386aacdb21dd7030d9dc9d5caf6d25">diagonalization::InverseR60</a></div><div class="ttdeci">kState_t InverseR60(const kState_t k, const int r, const kState_t dimX, const kState_t dimY)</div><div class="ttdoc">A function to impose a number of inverse R60 rotations on a given k state. </div><div class="ttdef"><b>Definition:</b> <a href="linear__momentum__constraints__2D_8cpp_source.html#l00221">linear_momentum_constraints_2D.cpp:221</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="i__const__def_8hpp_html_ab03128f28254e912f824640e69fc85ad"><div class="ttname"><a href="i__const__def_8hpp.html#ab03128f28254e912f824640e69fc85ad">I</a></div><div class="ttdeci">static const std::complex&lt; double &gt; I</div><div class="ttdef"><b>Definition:</b> <a href="i__const__def_8hpp_source.html#l00014">i_const_def.hpp:14</a></div></div>
<div class="ttc" id="namespacediagonalization_html_a26ca92638e21ae8791b99ae7fa90dd4c"><div class="ttname"><a href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">diagonalization::kState_t</a></div><div class="ttdeci">uint16_t kState_t</div><div class="ttdoc">Define an unsigned quantum number index type (a 16 bit unsigned int) </div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00039">orbital_and_state_defs.hpp:39</a></div></div>
<div class="ttc" id="namespacediagonalization_html_adeb6d2d193b9d4a086509c6e933a2096"><div class="ttname"><a href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">diagonalization::fock_t</a></div><div class="ttdeci">uint64_t fock_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00036">orbital_and_state_defs.hpp:36</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a948a6b1b3daa673cc4ebd93eb0af6770"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">utilities::MpiWrapper::m_lastTask</a></div><div class="ttdeci">int m_lastTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00064">mpi_wrapper.hpp:64</a></div></div>
<div class="ttc" id="dcmplx__type__def_8hpp_html_a52196b4b274b585226e0614490f7defc"><div class="ttname"><a href="dcmplx__type__def_8hpp.html#a52196b4b274b585226e0614490f7defc">dcmplx</a></div><div class="ttdeci">std::complex&lt; double &gt; dcmplx</div><div class="ttdef"><b>Definition:</b> <a href="dcmplx__type__def_8hpp_source.html#l00014">dcmplx_type_def.hpp:14</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="pi__const__def_8hpp_html_a952eac791b596a61bba0a133a3bb439f"><div class="ttname"><a href="pi__const__def_8hpp.html#a952eac791b596a61bba0a133a3bb439f">PI</a></div><div class="ttdeci">static const double PI</div><div class="ttdef"><b>Definition:</b> <a href="pi__const__def_8hpp_source.html#l00013">pi_const_def.hpp:13</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_ab7c5634cdbed7e4436b54b9ef619f85b"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">utilities::MpiWrapper::Sync</a></div><div class="ttdeci">void Sync(std::string &amp;buffer, int syncNode) const </div><div class="ttdoc">A function to MPI synchronize a string. </div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00345">mpi_wrapper.cpp:345</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad45972c4fdafd4512a218128054c9684"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class H &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void diagonalization::Observables::TranslationalDensityDensityFunction </td>
          <td>(</td>
          <td class="paramtype">const H &amp;&#160;</td>
          <td class="paramname"><em>hamiltonian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a>&#160;</td>
          <td class="paramname"><em>eigenvectorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1, const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2)&gt;&#160;</td>
          <td class="paramname"><em>StateAddition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a>(const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1, const <a class="el" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2)&gt;&#160;</td>
          <td class="paramname"><em>StateSubtraction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>functionList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structutilities_1_1MpiWrapper.html">utilities::MpiWrapper</a> &amp;&#160;</td>
          <td class="paramname"><em>mpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a list of the total translational density-density operator associated with a pair of orbitals for a given eigenvector. </p>
<p>Given by:</p>
<p>S(q) = 1/N sum_{k1,k2} &lt;c^+_k2-q c_k2 c^+_k1+q c_k1&gt;</p>
<p>Where q takes any value in the simulation grid</p>
<p>This function MUST be called on all nodes if run in parallel </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hamiltonian</td><td>Hamiltonian object </td></tr>
    <tr><td class="paramname">eigenvectorIndex</td><td>Index of eigenvector to analyse </td></tr>
    <tr><td class="paramname">StateAddition</td><td>A function to calculate the output from summing any two k-states k1+k2 </td></tr>
    <tr><td class="paramname">StateSubtraction</td><td>A function to calculate the output from subtracting any two k-states k1-k2 </td></tr>
    <tr><td class="paramname">functionList</td><td>Pre-allocated array to store a map of occupation probabilities for each G value </td></tr>
    <tr><td class="paramname">mpi</td><td>Instance of the mpi wrapper class </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fermion__observables_8hpp_source.html#l00217">217</a> of file <a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">if</span>(hamiltonian.m_data.m_eigenvectorsCalculated)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">if</span>(eigenvectorIndex&gt;hamiltonian.m_data.m_nbrEigenvalues)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    <span class="keywordflow">if</span>(0 == mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        std::cerr&lt;&lt;<span class="stringliteral">&quot;\n\tERROR in TranslationalDensityDensityFunction: eigenvectorIndex out of range.&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="comment">//  Ensure that the function list is initialized to zero</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; it : functionList)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    it = 0.0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="comment">//  Apply the operator c^+_k2-G c_k2 c^+_k1+G c_k1 to each Fock state</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="comment">//  and then determine the matrix element with the initial Fock state</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="comment">//  Loop over the Fock basis</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">DivideTasks</a>(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">m_id</a>, hamiltonian.m_data.m_fockSpaceDim, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">m_nbrProcs</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, &amp;mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                std::vector&lt;fock_t&gt;::const_iterator it_state;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> currState = hamiltonian.m_fockBasis.GetFirstState(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>, hamiltonian.m_data.m_nbrParticles, it_state);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keyword">auto</span> it_eigs = hamiltonian.m_eigenvectors.begin() + eigenvectorIndex*hamiltonian.GetEigenvectorNodeDim();</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">iSize_t</a> i = mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">m_firstTask</a>; i&lt;=mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">m_lastTask</a>; ++i, ++it_eigs)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> inState = currState;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    <span class="keywordtype">double</span> currProb = std::real(*it_eigs * std::conj(*it_eigs));</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> tempState = inState;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    <span class="keywordflow">while</span>(tempState!=0) <span class="comment">//  Iterate over N terms</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        <span class="comment">//  Isolate successive right-most bits until we&#39;ve included all</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        <span class="comment">//  occupied states in the current basis state</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k1Occupied = tempState &amp; -tempState;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k1 = <a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(k1Occupied-1);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        <span class="keywordflow">for</span>(<a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> q = 0; q&lt;functionList.size(); ++q)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k1PlusQOccupied = (<a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>)1 &lt;&lt; <a class="code" href="namespacediagonalization.html#a64d001257466117013a4487a4c5ea64a">StateAddition</a>(k1, q);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                            <span class="comment">//  Act on the current in state with CdC</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            <span class="keywordtype">int</span> sign;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                            <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> outState = <a class="code" href="namespaceutilities.html#a54074ad1aa43454e68e44d9a5d5cf349">utilities::Evaluate_CdC</a>(sign, k1PlusQOccupied, k1Occupied, inState, </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                                                                      hamiltonian.m_data.m_highestOrbital);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                            <span class="keywordflow">if</span>(sign!=0)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                            {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> tempState2 = outState;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                <span class="keywordflow">while</span>(tempState2!=0) <span class="comment">//  Iterate over N terms</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                    <span class="comment">//  Isolate the right-most bit</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k2Occupied = tempState2 &amp; -tempState2;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                    <a class="code" href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">kState_t</a> k2 = <a class="code" href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a>(k2Occupied-1);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                    <span class="comment">//  Isolate successive right-most bits until we&#39;ve included all</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                    <span class="comment">//  occupied states in the current basis state</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> k2MinusQOccupied = (<a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a>)1 &lt;&lt; <a class="code" href="namespacediagonalization.html#abf38b3571fb3d1613b56a18dec321d30">StateSubtraction</a>(k2, q);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                    <span class="comment">//  Act on the current in state with CdC</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                    <span class="keywordtype">int</span> sign2;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                    <a class="code" href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">fock_t</a> outState2 = <a class="code" href="namespaceutilities.html#a54074ad1aa43454e68e44d9a5d5cf349">utilities::Evaluate_CdC</a>(sign2, k2MinusQOccupied, k2Occupied, outState, </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                                                               hamiltonian.m_data.m_highestOrbital);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                    <span class="comment">//  Include the result if the out state matches the in state</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                    <span class="keywordflow">if</span>(outState2 == inState &amp;&amp; sign2 != 0)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                    {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                        functionList[q] += sign*sign2*currProb;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                    <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                    tempState2 = tempState2 ^ k2Occupied;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                            }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        <span class="comment">//  Remove right-most bit and proceed to the next iteration</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        tempState = tempState ^ k1Occupied;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    currState = hamiltonian.m_fockBasis.GetNextState(currState,it_state);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                MPI_Barrier(mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="comment">//  Allocate a temporary buffer for MPI communication</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="keywordtype">double</span>* reduceBuffer = <span class="keyword">new</span> <span class="keywordtype">double</span>[functionList.size()];</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                MPI_Status status;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">Reduce</a>(functionList.data(), reduceBuffer, functionList.size(), 0, mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">m_comm</a>, status);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="comment">//  MPI_sync the return array over all nodes</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                mpi.<a class="code" href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">Sync</a>(functionList.data(), functionList.size(), 0);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                <span class="keyword">delete</span>[] reduceBuffer;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="comment">//  Divide all values by a factor of N</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; it : functionList)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    it /= hamiltonian.m_data.m_nbrParticles;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        }</div>
<div class="ttc" id="namespacediagonalization_html_ab6352a2fe0c11db386c8f3e4fc09c38d"><div class="ttname"><a href="namespacediagonalization.html#ab6352a2fe0c11db386c8f3e4fc09c38d">diagonalization::iSize_t</a></div><div class="ttdeci">uint32_t iSize_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00043">orbital_and_state_defs.hpp:43</a></div></div>
<div class="ttc" id="namespacediagonalization_html_abf38b3571fb3d1613b56a18dec321d30"><div class="ttname"><a href="namespacediagonalization.html#abf38b3571fb3d1613b56a18dec321d30">diagonalization::StateSubtraction</a></div><div class="ttdeci">kState_t StateSubtraction(const kState_t k1, const kState_t k2, const kState_t dimX1, const kState_t dimY1, const kState_t dimX2, const kState_t dimY2)</div><div class="ttdoc">A function to subtract two k-states to give a result that is periodic in the unit cell...</div><div class="ttdef"><b>Definition:</b> <a href="linear__momentum__constraints__2D_8cpp_source.html#l00151">linear_momentum_constraints_2D.cpp:151</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a58a92efc3951241eb3548b58bdf2c5ab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a58a92efc3951241eb3548b58bdf2c5ab">utilities::MpiWrapper::DivideTasks</a></div><div class="ttdeci">void DivideTasks(const int id, const int nbrTasks, int nbrProcs, int *firstTask, int *lastTask, const bool display) const </div><div class="ttdoc">DivideTasks divides up nbrTasks tasks amongst nbrProcs processes On the processor labelled by the ide...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00166">mpi_wrapper.cpp:166</a></div></div>
<div class="ttc" id="namespaceutilities_1_1binary_html_a067057e4bb4d8570a644f35f3cf0b88f"><div class="ttname"><a href="namespaceutilities_1_1binary.html#a067057e4bb4d8570a644f35f3cf0b88f">utilities::binary::HammingWeight64</a></div><div class="ttdeci">int HammingWeight64(uint64_t x)</div><div class="ttdoc">Hamming weight algorithm with minimal number of arithmetic operations. </div><div class="ttdef"><b>Definition:</b> <a href="binary__number__tools_8cpp_source.html#l00095">binary_number_tools.cpp:95</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_aafee6ab3a3b23174586b41f38da96bab"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#aafee6ab3a3b23174586b41f38da96bab">utilities::MpiWrapper::m_firstTask</a></div><div class="ttdeci">int m_firstTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00061">mpi_wrapper.hpp:61</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_acd224a7c1052298744ef984a3341b66e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#acd224a7c1052298744ef984a3341b66e">utilities::MpiWrapper::Reduce</a></div><div class="ttdeci">void Reduce(T *reduceBuffer, T *recvBuffer, int bufferCount, int reduceId, MPI_Comm comm, MPI_Status status) const </div><div class="ttdoc">A function to implement MPI Reduce, but with different sizes of buffer on each node (the standard MPI...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00262">mpi_wrapper.hpp:262</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a7e00700c79360216f60abafad2b0ab1f"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a7e00700c79360216f60abafad2b0ab1f">utilities::MpiWrapper::m_comm</a></div><div class="ttdeci">MPI_Comm m_comm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00069">mpi_wrapper.hpp:69</a></div></div>
<div class="ttc" id="namespacediagonalization_html_a64d001257466117013a4487a4c5ea64a"><div class="ttname"><a href="namespacediagonalization.html#a64d001257466117013a4487a4c5ea64a">diagonalization::StateAddition</a></div><div class="ttdeci">kState_t StateAddition(const kState_t k1, const kState_t k2, const kState_t dimX1, const kState_t dimY1, const kState_t dimX2, const kState_t dimY2)</div><div class="ttdoc">A function to add two k-states to give a result that is periodic in the unit cell. </div><div class="ttdef"><b>Definition:</b> <a href="linear__momentum__constraints__2D_8cpp_source.html#l00128">linear_momentum_constraints_2D.cpp:128</a></div></div>
<div class="ttc" id="namespacediagonalization_html_a26ca92638e21ae8791b99ae7fa90dd4c"><div class="ttname"><a href="namespacediagonalization.html#a26ca92638e21ae8791b99ae7fa90dd4c">diagonalization::kState_t</a></div><div class="ttdeci">uint16_t kState_t</div><div class="ttdoc">Define an unsigned quantum number index type (a 16 bit unsigned int) </div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00039">orbital_and_state_defs.hpp:39</a></div></div>
<div class="ttc" id="namespacediagonalization_html_adeb6d2d193b9d4a086509c6e933a2096"><div class="ttname"><a href="namespacediagonalization.html#adeb6d2d193b9d4a086509c6e933a2096">diagonalization::fock_t</a></div><div class="ttdeci">uint64_t fock_t</div><div class="ttdef"><b>Definition:</b> <a href="orbital__and__state__defs_8hpp_source.html#l00036">orbital_and_state_defs.hpp:36</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a948a6b1b3daa673cc4ebd93eb0af6770"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a948a6b1b3daa673cc4ebd93eb0af6770">utilities::MpiWrapper::m_lastTask</a></div><div class="ttdeci">int m_lastTask</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00064">mpi_wrapper.hpp:64</a></div></div>
<div class="ttc" id="namespaceutilities_html_a54074ad1aa43454e68e44d9a5d5cf349"><div class="ttname"><a href="namespaceutilities.html#a54074ad1aa43454e68e44d9a5d5cf349">utilities::Evaluate_CdC</a></div><div class="ttdeci">uint64_t Evaluate_CdC(int &amp;coefficient, const uint64_t k1Occupied, const uint64_t k2Occupied, const uint64_t state, const uint64_t highestOrbital)</div><div class="ttdoc">Apply an operator c^+_k1 c_k2 to a given state. </div><div class="ttdef"><b>Definition:</b> <a href="fermions_8hpp_source.html#l00155">fermions.hpp:155</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0f670cb88d82d9c815e111de5e76ae3e"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0f670cb88d82d9c815e111de5e76ae3e">utilities::MpiWrapper::m_id</a></div><div class="ttdeci">int m_id</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00056">mpi_wrapper.hpp:56</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_a0615e4621e3e3fe7c42f6e5bc0f00d6a"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#a0615e4621e3e3fe7c42f6e5bc0f00d6a">utilities::MpiWrapper::m_nbrProcs</a></div><div class="ttdeci">int m_nbrProcs</div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8hpp_source.html#l00054">mpi_wrapper.hpp:54</a></div></div>
<div class="ttc" id="structutilities_1_1MpiWrapper_html_ab7c5634cdbed7e4436b54b9ef619f85b"><div class="ttname"><a href="structutilities_1_1MpiWrapper.html#ab7c5634cdbed7e4436b54b9ef619f85b">utilities::MpiWrapper::Sync</a></div><div class="ttdeci">void Sync(std::string &amp;buffer, int syncNode) const </div><div class="ttdoc">A function to MPI synchronize a string. </div><div class="ttdef"><b>Definition:</b> <a href="mpi__wrapper_8cpp_source.html#l00345">mpi_wrapper.cpp:345</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="fermion__observables_8hpp_source.html">fermion_observables.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacediagonalization.html">diagonalization</a></li><li class="navelem"><a class="el" href="structdiagonalization_1_1Observables.html">Observables</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
